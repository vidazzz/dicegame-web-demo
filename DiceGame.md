# 骰子事件游戏 - 玩法原型文档

---

## 1. MVP 范围

- 单个固定事件的完整流程（生成 → 准备 → 执行 → 结算）
- 行动点系统、情报获取成功率系统、骰子匹配机制、Fever 连击系统
- 4个NPC（天哥、雨姐、陈珂、陈老师）
- 无存档、简化UI

---

## 2. 游戏阶段

游戏分为以下5个阶段：

| 阶段 | 名称 | 说明 |
|------|------|------|
| 1 | **准备阶段 (SETUP)** | 初始化游戏，选择难度 |
| 2 | **情报收集阶段 (COLLECT)** | 与NPC交互获取情报 |
| 3 | **情报处理阶段 (PROCESS)** | 投骰子处理情报，增加数字或告知NPC |
| 4 | **交涉进行阶段 (EVENT)** | 分为不利情报解决和有利情报打出两个子阶段 |
| 5 | **结算阶段 (RESULT)** | 计算总分，判断成功/完美达成 |

---

## 3. 事件生成规则

### 3.1 事件参数

事件生成时，包含以下参数：
- **事件名**
- **话题**（暂定3个）
- **话题对应的情报数量**（暂定每个话题3个）
- **话题对应的难度**
  - 简单难度：最多1个不利情报
  - 困难难度：最多3个不利情报
- **事件对应的情报NPC**：最多3个
- **事件对应的参与NPC**：最多3个
- 以上两类NPC需要最少有2个交集

### 3.2 NPC 生成

每个事件的NPC从固定的NPC池中抽取。

**NPC池：**

| 角色 | 描述 |
|------|------|
| 天哥 | 组长 |
| 雨姐 | 对方组长 |
| 陈珂 | PM |
| 陈老师 | UI |

**NPC参数：**
- **情报获取成功率**：0%～90%间随机，上限100%
- **基础成功率 (baseIntelRate)**：初始随机生成，用于交涉阶段
- **当前成功率 (intelRate)**：收集阶段使用，失败时提升10%
- **是否对某个情报知情**
- **自带数字**：1～6间的随机一个（每个话题开始时生成，使用后重新生成）

### 3.3 情报生成

根据事件的参数生成对应的情报：
- 情报有所属的话题
- 情报分为有利与不利
- 情报分值：100分 / 300分
  - 100分情报：上面有3个数字
  - 300分情报：上面有2个数字
- 数字是1～6间的随机一个，且数字间不能相同
- 知情者：参与事件的一个或多个NPC

**NPC情报分配规则：**
- 每个参与事件的NPC至少拥有1个情报
- 确保4个NPC中至少3个会成为情报的知情人

**情报类型：**

| 类型 | 说明 |
|------|------|
| 秘密情报 | 仅有一个知情人 |
| 公开情报 | 有多个知情人，玩家能直接知道是谁 |
| 小道情报 | 有多个知情人，但玩家不能直接知道是谁 |

---

## 4. 情报收集阶段

**行动点**：每个事件10点

**搜集情报**（消耗1行动点）：
- 玩家主动选择与哪个NPC交互
- 交互成功：获得该NPC拥有的所有情报
- 交互成功率 = NPC情报获取成功率
- 失败时，该NPC交互成功率+10%，上限100%

**初始情报源**：
- 玩家从初始情报源处获取情报，无视成功率必然成功
- 初始情报数占总情报数量的30%～70%之间随机
- 获取后会告知玩家初始情报占事件总情报的比例：
  - 小部分：小于40%
  - 一半：大于等于40%，小于等于60%
  - 大部分：大于60%

---

## 5. 情报处理阶段

**处理情报**（消耗1行动点）：
- 玩家投出一个骰子
- **处理成功**：投出的点数与情报上的数字一致，成功在情报上增加一个随机数字
- **处理失败**：投出的点数与情报上的数字不一致，无法增加数字

**告知NPC情报**（消耗1行动点）：
- 玩家可主动将收集到的情报告知任意一个NPC
- 该NPC将成为该情报的知情人

---

## 6. 交涉进行阶段

交涉由玩家和所有参与事件的NPC共同推进。

### 6.1 话题开始

1. 每个参与的 NPC 投一个骰子，获得一个 1～6 的数字
2. 系统先打出所有不利情报（卡牌游戏形式，逐张展示）
3. 玩家需要解决不利情报

### 6.2 解决不利情报

1. 玩家投出一个骰子
2. 点数需与不利情报上的数字一致
3. **解决成功**：
   - 该情报转变为有利情报
   - 继续进入加成判定阶段
4. **解决失败**：退出 Fever 状态，扣除该不利情报标注的分数

### 6.3 打出有利情报

- 不利情报全部解决/跳过后，进入有利情报阶段
- 玩家可选择打出有利情报或跳过
- 玩家可选择跳过或调整有利情报的出牌顺序

### 6.4 情报分数加成判定

1. 玩家投出一个骰子
2. 可选择使用多个 NPC 的数字（每个数字 = 一个骰子结果）
3. 所有骰子（玩家 + NPC）的点数必须与情报上的数字一致
4. **加成成功**：
   - 2 个一样的数字：情报分数 × 2
   - 3 个一样的数字：情报分数 × 4
   - 4 个一样的数字：情报分数 × 8
   - 进入 Fever 状态
5. **加成失败**：退出 Fever 状态

### 6.5 Fever 状态

- 每次连续成功，该次得分增加10%（倍率累加）
- 连续成功 1 次：1.1倍
- 连续成功 2 次：1.2倍
- 连续成功 3 次：1.3倍，依此类推
- **进入Fever时**：记录当前得分，后续连续成功的得分加入缓存
- **退出Fever时**：结算 Fever 缓存期间的所有得分之和，乘以最终倍率，加到总分
- 已结算的分数不追溯
- 退出后倍率重置，下次进入Fever从1.1倍重新开始

### 6.6 NPC 数字使用规则

**不利情报解决判定：**
- NPC 知晓此情报：不能使用
- NPC 不知晓此情报：可使用该 NPC 数字

**有利情报加成判定：**
- NPC 知晓此情报：直接使用，成功率 100%
- NPC 不知晓此情报：可使用该 NPC 数字，成功率 = 好感度

**加成计算方式：**
- 玩家骰子 + 所有选中的 NPC 骰子 = 骰子池
- 骰子池中与情报数字一致的骰子数量决定倍数
- 例如：情报数字为 5，玩家投出 5，NPC1 的数字是 5，NPC2 的数字是 3
  - 骰子池中有 2 个 5
  - 2 个一样 → 情报分数 × 2

---

## 7. 结算阶段

所有情报处理完毕后进入结算：
- 计算信息总分
- 第一档：信息总分 × 1.5 = 事件成功
- 第二档：信息总分 × 4 = 事件完美达成

---

## 8. 难度设计

| 难度 | 不利情报 | 300分有利情报 | 100分有利情报 |
|------|----------|---------------|---------------|
| 简单 | 最多1个/话题 | 2个 | 1个 |
| 困难 | 最多3个/话题 | 2个 | 1个 |

---

## 9. NPC 情报成功率机制

- 每个 NPC 有两个成功率：baseIntelRate（初始成功率）和 intelRate（当前成功率）
- 情报收集阶段：使用 intelRate，失败时提升10%
- 交涉进行阶段：使用 baseIntelRate
- NPC 失败后成功率提升仅影响收集阶段，不影响后续交涉阶段的判定
